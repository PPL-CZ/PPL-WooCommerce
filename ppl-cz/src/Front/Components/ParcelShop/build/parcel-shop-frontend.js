(()=>{"use strict";const e=window.wp.element,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"pplcz/parcel-shop-block","version":"1.0.0","title":"Selection block","category":"woocommerce","parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"checkout-block-example","editorScript":"file:./build/index.js"}'),n=window.wc.blocksCheckout,l=window.wp.data,a=window.wp.i18n,r=window.React,{registerPlugin:o}=window.wp.plugins,c=e=>(e=>e.shipping_rates.find((e=>e.rate_id.indexOf("pplcz_")>-1&&e.selected)))(e)?.meta_data,p=(e,t)=>c(e)?.find((e=>e.key===t))?.value,s=e=>e.extensions?.pplcz_parcelshop?.["parcel-shop"],i=t=>{const{cart:n,parcelRequired:l}=t,o=s(n);return(0,e.createElement)("div",null,o?(0,e.createElement)(r.Fragment,null,(0,e.createElement)("strong",null,(0,a.__)("Výdejní místo","ppl-cz")),(0,e.createElement)("br",null),(0,e.createElement)("span",null,o.name),", ",(0,e.createElement)("span",null,o.street),", ",(0,e.createElement)("span",null,o.zipCode),", ",(0,e.createElement)("span",null,o.city),(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),PplMap((()=>{}),{lat:o?.gps.latitude,lng:o?.gps.longitude})}},"[",(0,a.__)("na mapě","ppl-cz"),"]")):l?(0,e.createElement)(r.Fragment,null,(0,a.__)("Vyberte výdejní místo pro doručení zásilky","ppl-cz")):(0,e.createElement)(r.Fragment,null,(0,a.__)("Zboží bude dodáno na doručovací adresu","ppl-cz")))},d=({cart:t,payment:l,parcelShopBoxSelected:o})=>{const s=t.shippingRates[0],d=s?.shipping_rates.find((e=>!0===e.selected&&e.method_id.indexOf("pplcz_")>-1)),m=s?.destination,u=(0,r.useRef)(!1),{parcelRequired:h,mapAllowed:g,hiddenPoints:_,allowedCountries:b,mapSetting:w}=(0,r.useMemo)((()=>{const e=(e=>!!parseInt(p(e,"parcelRequired")))(s),t=(e=>!!parseInt(p(e,"mapEnabled")))(s),n=(e=>{const t=c(e)||[];return Object.entries({ParcelBox:"parcelBoxEnabled",ParcelShop:"parcelShopEnabled",AlzaBox:"alzaBoxEnabled"}).filter((([e,n])=>!t.some((e=>e.key===n&&e.value)))).map((([e])=>e))})(s),l=(e=>{var t;return null!==(t=p(e,"enabledParcelCountries"))&&void 0!==t?t:[]})(s);let a="",r="";m&&(a=[[m.address_1,m.address_2].filter((e=>e)).join(" "),[m.postcode,m.city].filter((e=>e)).join(" ")].filter((e=>e)).join(", "),r=m.country?.toLowerCase()||""),o&&(a=[o.street,[o.zipCode,o.city].filter((e=>e)).join(" ")].filter((e=>e)).join(", "),r=o.country||"");const i={address:a,country:r,hiddenPoints:n.length?n.join(","):null,countries:l.map((e=>e.toLowerCase())).join(",")};return{parcelRequired:e,mapAllowed:t,hiddenPoints:n,allowedCountries:l,mapSetting:i}}),[d]);window.pplczLastPplMapData=w;const k=Array.from(document.getElementsByTagName("meta")).some((e=>"pplcz:cart"===e.property&&"1"===e.content)),f=!h||!g||k,y=e=>{(0,n.extensionCartUpdate)({namespace:"pplcz_parcelshop",data:{"parcel-shop":e}})};if((0,r.useEffect)((()=>{u.current?!h||o||f||PplMap(y,{...w}):u.current=!0}),[h,o]),f)return null;let E=[];return h&&!o&&E.push((0,e.createElement)("li",{key:"ageControl"},(0,a.__)("Pro dodání zboží je nutno vybrat jedno z výdejních míst","ppl-cz"))),(0,e.createElement)("div",null,(0,e.createElement)(i,{cart:t,parcelRequired:h}),(0,e.createElement)("a",{href:"#withCard",className:"pplcz-select-parcelshop",onClick:e=>{e.preventDefault(),PplMap(y,{...w})}},(0,a.__)("Výběr výdejního místa","ppl-cz")),o&&(0,e.createElement)(r.Fragment,null," / ",(0,e.createElement)("a",{href:"#",className:"pplcz-clear-map",onClick:e=>{e.preventDefault(),u.current=!1,y(null)}},(0,a.__)("Zrušit výběr","ppl-cz"))),(0,e.createElement)("br",null),E.length>0&&(0,e.createElement)("ul",null,E))},m={metadata:t,component:t=>{const{cart:n,payment:a}=(0,l.useSelect)((e=>({cart:e("wc/store/cart").getCartData(),payment:e("wc/store/payment").getActivePaymentMethod()}))),o=n?.shippingRates?.[0],c=n?s(n):null,p=(0,r.useMemo)((()=>n?.shippingRates?.length?[...new Set(n.shippingRates.reduce(((e,t)=>e.concat(t.shipping_rates?.map((e=>e.rate_id))||[])),[]))].sort():[]),[n?.shippingRates]);return(0,r.useEffect)((()=>{o?.shipping_rates?.length&&((e,t,n)=>{const l=e.map((e=>{const l=t.shipping_rates.find((t=>t.rate_id===e));if(!l?.rate_id.startsWith("pplcz_"))return"";const a={"background-size":"auto 1em","background-position":"center center","background-repeat":"no-repeat",display:"inline-block",content:"''",height:"1em","vertical-align":"middle"};let r=`${parcelshop_block_frontend.assets_url}/small_logo.png`;l.meta_data.some((e=>"parcelRequired"===e.key&&1==e.value||"mapEnabled"===e.key&&1==e.value))&&(r=`${parcelshop_block_frontend.assets_url}/small_logo.png`,l.selected&&("ParcelShop"===n?.accessPointType||"ParcelBox"===n?.accessPointType)&&(r=`${parcelshop_block_frontend.assets_url}/small_logo.png`)),a["background-image"]=`url('${r}')`,a.width="2em";const o=1!==t.shipping_rates.length?`.wc-block-components-shipping-rates-control #radio-control-0-${e.replace(":","\\:")}__label::after`:".wc-block-components-shipping-rates-control  .wc-block-components-radio-control__label:before";1===t.shipping_rates.length&&(a.display="block");const c=`${o} {\n\t\t\t\t${Object.keys(a).map((e=>`${e}: ${a[e]};`)).join("\n")}  \n\t\t\t}`;return c})).join("\n"),a=document.getElementById("ppl-shipping-images")||document.createElement("style");a.id||(a.id="ppl-shipping-images",document.head.appendChild(a)),a.innerHTML=l})(p,o,c)}),[p,o,c?.accessPointType]),n&&a&&n.shippingRates?.length?(0,e.createElement)(d,{cart:n,payment:a,parcelShopBoxSelected:c}):null}};(0,n.registerCheckoutBlock)(m)})();