(()=>{"use strict";const e=window.wp.element,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"pplcz/parcel-shop-block","version":"1.0.0","title":"Selection block","category":"woocommerce","parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"checkout-block-example","editorScript":"file:./build/index.js"}'),n=window.wc.blocksCheckout,a=window.wp.data,o=window.React,{registerPlugin:r}=window.wp.plugins,l=t=>{const{cart:n,parcelRequired:a}=t,r=n?.extensions?.pplcz_parcelshop?.["parcel-shop"];return(0,e.createElement)("div",null,r?(0,e.createElement)(o.Fragment,null,(0,e.createElement)("strong",null,"Výdejní místo"),(0,e.createElement)("br",null),(0,e.createElement)("span",null,r.name),", ",(0,e.createElement)("span",null,r.street),", ",(0,e.createElement)("span",null,r.zipCode),", ",(0,e.createElement)("span",null,r.city)," ",(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),PplMap((()=>{}),{lat:r?.gps.latitude,lng:r?.gps.longitude})}},"[na mapě]")):a?(0,e.createElement)(o.Fragment,null,"Vyberte výdejní místo pro doručení zásilky"):(0,e.createElement)(o.Fragment,null,"Zboží bude dodáno na doručovací adresu"))},c={metadata:t,component:t=>{const{checkoutExtensionData:r}=t,{cart:c,payment:p}=(0,a.useSelect)((e=>({cart:e("wc/store/cart").getCartData(),payment:e("wc/store/payment").getActivePaymentMethod()}))),s=[...new Set(c?.shippingRates?.reduce(((e,t)=>e.concat(t.shipping_rates?.map((e=>e.rate_id))||[])),[]).sort()||[])].sort(),i=c?.shippingRates?.[0],d=(e=>{const t=e?.shipping_rates?.find((e=>e.rate_id.indexOf("pplcz_")>-1&&e.selected)),n=t?.meta_data.find((e=>"parcelRequired"===e.key));return!!n&&!!parseInt(n.value)})(i),u=(e=>e.extensions?.pplcz_parcelshop?.["parcel-shop"])(c),m=(0,o.useRef)(!1);let h=null;const g=Array.from(document.getElementsByTagName("meta")).some((e=>"pplcz:cart"===e.property&&"1"===e.content)),k=!d||!(e=>{const t=e?.shipping_rates?.find((e=>e.rate_id.indexOf("pplcz_")>-1&&e.selected)),n=t?.meta_data?.find((e=>"mapEnabled"===e.key));return!!parseInt(n?.value)})(i)||g;if((0,o.useEffect)((()=>{m.current?!d||u||k||PplMap(y,{...h}):m.current=!0}),[d,u]),(0,o.useEffect)((()=>{i&&((e,t,n)=>{const a=e.map((e=>{const a=t.shipping_rates.find((t=>t.rate_id===e));if(!a.rate_id.startsWith("pplcz_"))return"";const o={"background-size":"auto 2em","background-repeat":"no-repeat",display:"inline-block",content:"''",height:"2em"};let r=`${parcelshop_block_frontend.assets_url}/ppldhl_4084x598.png`;a.meta_data.some((e=>"parcelRequired"===e.key&&1==e.value||"mapEnabled"===e.key&&1==e.value))&&(r=`${parcelshop_block_frontend.assets_url}/vydejnimista_1329x500.png`,a.selected&&("ParcelShop"===n?.accessPointType?r=`${parcelshop_block_frontend.assets_url}/parcelshop_2609x1033.png`:"ParcelBox"===n?.accessPointType&&(r=`${parcelshop_block_frontend.assets_url}/parcelbox_2625x929.png`))),o["background-image"]=`url('${r}')`;const l=r.match(/_([0-9]+)x([0-9]+)\./),c=2*l[1]/l[2];o.width=c+"em";const p=1!==t.shipping_rates.length?`.wc-block-components-shipping-rates-control  input[value=${e}]+div:before`:".wc-block-components-shipping-rates-control  .wc-block-components-radio-control__label:before";1===t.shipping_rates.length&&(o.display="block");const s=`${p} {\n\t\t\t\t${Object.keys(o).map((e=>`${e}: ${o[e]};`)).join("\n")}  \n\t\t\t}`;return s})).join("\n"),o=document.getElementById("ppl-shipping-images")||document.createElement("style");o.id||document.head.appendChild(o),o.innerHTML=a})(s,i,u)}),s.concat((u||{}).accessPointType)),k)return null;const _=c.shippingAddress;let b="";_&&(b=[[_.address_1,_.address_2].filter((e=>e)).join(" "),[_.postcode,_.city].filter((e=>e)).join(" ")].filter((e=>!!e)).join(", "));const y=e=>{(0,n.extensionCartUpdate)({namespace:"pplcz_parcelshop",data:{"parcel-shop":e}})};let f=[];const v=c.extensions?.pplcz_parcelshop?.["parcel-shop"];return h={address:b},_?.country&&(h.country=_.country.toLowerCase()),v&&(h.address=[v.street,[v.zip,v.city].join(" ")].join(", "),h.country=v.country),(e=>{const t=e.shipping_rates?.find((e=>e.rate_id.indexOf("pplcz_")>-1&&e.selected)),n=t?.meta_data.find((e=>"ageRequired"===e.key));return!!parseInt(n?.value)})(i)&&(h.parcelShop=1,d?v&&"ParcelShop"===v.accessPointType||f.push((0,e.createElement)("li",{key:"ageControl"},"U jednoho nebo více produktů je požadována kontrola věku. Mapa je omezená pouze na výběr obchodů")):f.push((0,e.createElement)("li",{key:"ageControl"},'V případě, že zvolíte dovoz přes službu "výdejní místa", je mapa omezena pouze na výběr obchodů, protože je u jednoho nebo více produktů požadována kontrola věku'))),d&&!v&&f.push((0,e.createElement)("li",{key:"ageControl"},"Pro dodání zboží je nutno vybrat jedno z výdejních míst")),(0,e.createElement)(o.Fragment,null,(0,e.createElement)("div",null,(0,e.createElement)(l,{cart:c,parcelRequired:d})," Výběr výdejního místa ",(0,e.createElement)("a",{href:"#withCard",onClick:e=>{e.preventDefault(),PplMap(y,{...h})}},"Vše")," / ",(0,e.createElement)("a",{href:"#withoutCard",onClick:e=>{e.preventDefault(),PplMap(y,{withCash:!0,...h})}},"S možnosti platit hotově")," ",u?(0,e.createElement)(o.Fragment,null," / ",(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),m.current=!1,y(null)}},"Zrušit výběr")):null," ",(0,e.createElement)("br",null),f?(0,e.createElement)("ul",null,f):null))}};(0,n.registerCheckoutBlock)(c)})();