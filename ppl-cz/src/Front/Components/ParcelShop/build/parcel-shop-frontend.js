(()=>{"use strict";const e=window.wp.element,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"pplcz/parcel-shop-block","version":"1.0.0","title":"Selection block","category":"woocommerce","parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"checkout-block-example","editorScript":"file:./build/index.js"}'),n=window.wc.blocksCheckout,a=window.wp.data,l=window.React,{registerPlugin:r}=window.wp.plugins,o=e=>(e=>e?.shipping_rates?.find((e=>e.rate_id.indexOf("pplcz_")>-1&&e.selected)))(e)?.meta_data,c=(e,t)=>o(e)?.find((e=>e.key===t))?.value,s=e=>e?.extensions?.pplcz_parcelshop?.["parcel-shop"],p=t=>{const{cart:n,parcelRequired:a}=t,r=s(n);return(0,e.createElement)("div",null,r?(0,e.createElement)(l.Fragment,null,(0,e.createElement)("strong",null,"Výdejní místo"),(0,e.createElement)("br",null),(0,e.createElement)("span",null,r.name),", ",(0,e.createElement)("span",null,r.street),", ",(0,e.createElement)("span",null,r.zipCode),", ",(0,e.createElement)("span",null,r.city),(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),PplMap((()=>{}),{lat:r?.gps.latitude,lng:r?.gps.longitude})}},"[na mapě]")):a?(0,e.createElement)(l.Fragment,null,"Vyberte výdejní místo pro doručení zásilky"):(0,e.createElement)(l.Fragment,null,"Zboží bude dodáno na doručovací adresu"))},i={metadata:t,component:t=>{const{cart:r,payment:i}=(0,a.useSelect)((e=>({cart:e("wc/store/cart").getCartData(),payment:e("wc/store/payment").getActivePaymentMethod()}))),d=[...new Set(r?.shippingRates?.reduce(((e,t)=>e.concat(t.shipping_rates?.map((e=>e.rate_id))||[])),[]).sort()||[])].sort(),u=r?.shippingRates?.[0],m=u.shipping_rates.find((e=>!0===e.selected&&e.method_id.indexOf("pplcz_")>-1)),h=u.destination,g=s(r),b=(0,l.useRef)(!1),{parcelRequired:_,mapAllowed:k,hiddenPoints:f,allowedCountries:w,mapSetting:y}=(0,l.useMemo)((()=>{const e=!!parseInt(c(u,"parcelRequired")),t=!!parseInt(c(u,"mapEnabled")),n=(e=>{const t=o(e)||[];return Object.entries({ParcelBox:"parcelBoxEnabled",ParcelShop:"parcelShopEnabled",AlzaBox:"alzaBoxEnabled"}).filter((([e,n])=>!t.some((e=>e.key===n&&e.value)))).map((([e])=>e))})(u),a=(e=>{var t;return null!==(t=c(e,"enabledParcelCountries"))&&void 0!==t?t:[]})(u);let l="",r="";h&&(l=[[h.address_1,h.address_2].filter((e=>e)).join(" "),[h.postcode,h.city].filter((e=>e)).join(" ")].filter((e=>e)).join(", "),r=h.country?.toLowerCase()||""),g&&(l=[g.street,[g.zipCode,g.city].filter((e=>e)).join(" ")].filter((e=>e)).join(", "),r=g.country||"");const s={address:l,country:r,hiddenPoints:n.length?n.join(","):null,countries:a.map((e=>e.toLowerCase())).join(",")};return{parcelRequired:e,mapAllowed:t,hiddenPoints:n,allowedCountries:a,mapSetting:s}}),[m]);window.pplczLastPplMapData=y;const E=Array.from(document.getElementsByTagName("meta")).some((e=>"pplcz:cart"===e.property&&"1"===e.content)),v=!_||!k||E;if((0,l.useEffect)((()=>{b.current?!_||g||v||PplMap(j,{...y}):b.current=!0}),[_,g]),(0,l.useEffect)((()=>{u&&((e,t,n)=>{const a=e.map((e=>{const a=t?.shipping_rates?.find((t=>t.rate_id===e));if(!a.rate_id.startsWith("pplcz_"))return"";const l={"background-size":"auto 2em","background-repeat":"no-repeat",display:"inline-block",content:"''",height:"2em"};let r=`${parcelshop_block_frontend.assets_url}/ppldhl_4084x598.png`;a.meta_data.some((e=>"parcelRequired"===e.key&&1==e.value||"mapEnabled"===e.key&&1==e.value))&&(r=`${parcelshop_block_frontend.assets_url}/vydejnimista_1329x500.png`,a.selected&&("ParcelShop"===n?.accessPointType?r=`${parcelshop_block_frontend.assets_url}/parcelshop_2609x1033.png`:"ParcelBox"===n?.accessPointType&&(r=`${parcelshop_block_frontend.assets_url}/parcelbox_2625x929.png`))),l["background-image"]=`url('${r}')`;const o=r.match(/_([0-9]+)x([0-9]+)\./),c=2*o[1]/o[2];l.width=c+"em";const s=1!==t.shipping_rates.length?`.wc-block-components-shipping-rates-control  input[value=${e}]+div:before`:".wc-block-components-shipping-rates-control  .wc-block-components-radio-control__label:before";1===t.shipping_rates.length&&(l.display="block");const p=`${s} {\n\t\t\t\t${Object.keys(l).map((e=>`${e}: ${l[e]};`)).join("\n")}  \n\t\t\t}`;return p})).join("\n"),l=document.getElementById("ppl-shipping-images")||document.createElement("style");l.id||document.head.appendChild(l),l.innerHTML=a})(d,u,g)}),[...d,g?.accessPointType]),v)return null;const j=e=>{(0,n.extensionCartUpdate)({namespace:"pplcz_parcelshop",data:{"parcel-shop":e}})};let x=[];return console.log(_,y,j),_&&!g&&x.push((0,e.createElement)("li",{key:"ageControl"},"Pro dodání zboží je nutno vybrat jedno z výdejních míst")),(0,e.createElement)(l.Fragment,null,(0,e.createElement)("div",null,(0,e.createElement)(p,{cart:r,parcelRequired:_})," ",(0,e.createElement)("a",{href:"#withCard",className:"pplcz-select-parcelshop",onClick:e=>{e.preventDefault(),PplMap(j,{...y})}},"Výběr výdejního místa")," ",g?(0,e.createElement)(l.Fragment,null," / ",(0,e.createElement)("a",{href:"#",className:"pplcz-clear-map",onClick:e=>{e.preventDefault(),b.current=!1,j(null)}},"Zrušit výběr")):null," ",(0,e.createElement)("br",null),x?(0,e.createElement)("ul",null,x):null))}};(0,n.registerCheckoutBlock)(i)})();